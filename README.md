# Sensitivity Analysis - Postprocessing  

Scripts to perform the postprocessing of sensitivity analysis results obtained with **DAKOTA** and **MAMMA**.  
This repository provides tools to:  
- Extract and organize raw simulation outputs.  
- Generate correlation plots between input parameters and response functions.  
- Plot Sobol indices for variance-based sensitivity analysis.  
- (Planned) Extend functionality to frequency plots and other postprocessing tasks.  

## üìë Table of Contents  

1. [Repository Structure](#-repository-structure)  
2. [Preparation](#-preparation)  
3. [Data Extraction (`extract_allData.py`)](#-data-extraction-extract_alldatapy)  
4. [Correlation Plots (`plot_correlation.py`)](#-correlation-plots-plot_correlationpy)  
5. [Sobol Indices (`plot_sobol.py`)](#-sobol-indices-plot_sobolpy)  
6. [Future Extensions](#-future-extensions)  
7. [Notes](#-notes)  

## üìÇ Repository Structure  

- **`extract_allData.py`** ‚Üí Extracts all data from DAKOTA/MAMMA simulations into structured CSV files.  
- **`plot_correlation.py`** ‚Üí Generates correlation plots between input variables and response functions.  
- **`plot_sobol.py`** ‚Üí Plots Sobol sensitivity indices.  
- **`my_lib_extract_data.py`** ‚Üí Library of functions to support `estract_allData.py'.
- **`my_lib_process_utils.py`** ‚Üí Library of functions that support all the other scripts.

## ‚öôÔ∏è Preparation  

Make sure the working directory contains the following files:  

- `dakota_tabular.dat`  
- `dakota_test_parallel.in`  
- `conduit_solver.template`  

Additionally, you need a folder containing all the simulation results from the sensitivity analysis.  
A recommended structure is:  

workdir/

‚îú‚îÄ‚îÄ workdir.1/

‚îú‚îÄ‚îÄ workdir.2/

‚îú‚îÄ‚îÄ ...


## üìä Data Extraction (`extract_allData.py`)  

Run the extraction script to collect all simulation results into CSV files:  

```bash
python extract_allData.py

```

Optional arguments:

--verbose true/false ‚Üí Enable detailed logging.

--pause true/false ‚Üí Pause execution at key steps.

### Output

The script generates 34 CSV files organized by eruptive style (Explosive, Effusive, Fountaining, etc.) and saves them in the csv_files/ directory.

Examples:

`data_allConcat.csv`

`data_allConcat_explosive.csv`

`data_allConcat_notExplosive.csv`

`data_allConcat_notExplosive_effusive.csv`

`data_allConcat_notExplosive_fountaining.csv`

‚Ä¶ and others.

Each CSV file uses a *two-row header*:
- **level 0:** technical names (`x1`, `response_fn_12`, ‚Ä¶)  
- **level 1:** descriptive labels (`Pressure [Pa]`, `Exit velocity [m/s]`, ‚Ä¶)


---

## üìà Correlation Plots (plot_correlation.py) 

Generate correlation plots between input parameters (x1, x2, ‚Ä¶) and response functions (response_fn_*).


### ‚öôÔ∏è Features
- **File management**  
  - Checks for required input files (see below) in the `csv_files/` folder and in the current working directory. In the latter case, moves them automatically into the `csv_files/` folder.  
  - If missing, runs `extract_allData.py` to generate them.  
- **Data handling**  
  - Reads CSVs with two-row headers into `pandas.DataFrame` objects.  
  - Computes binned statistics (`bin_and_average`) for response functions.  
- **Plotting utilities** (from `my_lib_process_utils.py`):  
  - `plot_xi_vs_response_fn`: plot automatically each `xi` present vs. one response function.  
  - `plot_lists`: plot arbitrary pairs of variables.   
  Each plotting utility supports multiple datasets overlayed in the same figure (e.g., Explosive, Effusive, and Fountaining) or a single dataset only.
  In case that multiple datasets are plotted, each one has a distinct color and - if desidered - a distinct marker style.
  Each plotting utility supports the plot of the mean values *IF* a dictionary `stats` is passed.

### üìÇ Required files
- **Mandatory**  
  - `dakota_test_parallel.in` (DAKOTA input file containing parameter bounds).  
- **Optional: CSV datasets**  
  - `data_allConcat.csv`  
  - `data_allConcat_explosive.csv`  
  - `data_allConcat_notExplosive.csv`  
  - `data_allConcat_notExplosive_effusive.csv`  
  - `data_allConcat_notExplosive_fountaining.csv`  
  If present, they are loaded as dataFrame, otherwise they are generated by calling `extract_allData.py` and then loaded.

### ‚ñ∂Ô∏è Usage
Run from the terminal:

```bash
python plot_correlation.py
```

### Output
* Plots show scatter distributions and binned means for comparison.
* Multiple eruptive regimes (Explosive, Effusive, Fountaining) can be compared on the same plot.
* Saves figures in `.svg` format under `plot_correlations/`.

### Customization

The script can be easily customized to:

Select specific response_fn_* to analyze.

Apply transformations (e.g., log10, scaling) to axes.

Change labels and plot layouts.

---

## üìâ Sobol Indices (plot_sobol.py)

Plot Sobol sensitivity indices for selected response functions.

```bash
python plot_Sobol.py
```

Output

Figures saved in plot_Sobol/.

User can modify the script to choose which response_fn_* to analyze.


## ‚ú® Notes

All scripts are designed to be modified by the user to adapt to specific workflows. For example:
- Change the label names going into...

Figures are saved in .svg format for high-quality vector graphics. The user can change it going to...

